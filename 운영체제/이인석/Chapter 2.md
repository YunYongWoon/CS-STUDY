# Chapter 2. 운영체제 구조

## 운영체제 서비스

운영체제는 프로그램 실행 환경을 제공, 프로그램과 프로그램 사용자에게 특정 서비스 제공

- 사용자 인터페이스 : GUI, 터치 스크린 인터페이스, CLI 등등
- 프로그램 수행 (Program Execution)
    - 프로그램을 메모리에 적재해 실행한다.
    - 정상적이든, 비정상적이든 실행을 끝낼 수 있다.
- 입출력 연산 : 입출력 수행 수단 제공
- 파일 시스템 조작 : 파일 생성, 삭제, 검색, 읽기, 접근 허가 및 거부
- 통신 : 프로세스와 프로세스 사이의 통신, 네트워크 내의 컴퓨터 시스템 사이의 통신
- 오류 탐지 : 각 유형의 오류에 대한 적당한 조치 수행
- 자원 할당 : 다수의 프로세스나 다수의 작업에 대해서 자원 할당
- 기록 작성
- 보호와 보안

## 시스템 콜

운영체제에 의해 사용 가능하게 된 서비스에 대한 인터페이스

### 응용 프로그래밍 인터페이스 (Application Programming Interface)

- 매개변수들과 반환 값을 포함한 응용 프로그래머가 사용 가능한 함수의 집합
- 프로그램은 운영체제의 기능을 많이 쓰고, 종종 초당 수천 개의 시스템 콜을 수행할 수도 있다.  대부분의 응용 개발자들은 이를 모르고 응용 프로그래밍 인터페이스(API)에 따라 프로그램을 설계한다.
- API 호출은 어느 시스템이든 컴파일되고 실행되는 것을 기대할 수 있다는 이점이 있다(호환성)

### 실행 시간 환경 (RTE)

- 컴파일러, 인터프리터 등 특정 언어가 실행되는데 필요한 소프트웨어 전부를 가리킴
    - JRE, 라이브러리, 로더 등등
- 운영체제가 제공하는 시스템 콜에 대한 연결고리 역할을 하는 시스템 콜 인터페이스를 제공한다.
- 운영체제 인터페이스의 대부분은 내용은 API에 의해 숨겨지고 RTE에 의해 관리된다.

    ![시스템 콜 인ㅍ터페이스](https://user-images.githubusercontent.com/66675919/234514513-19ae97b3-74f9-4e3b-b4c3-e5d6a8709d8a.PNG)

### 운영체제에 매개변수 전달 방법

- 매개변수를 레지스터 내에 전달하는 방법
    - 레지스터보다 매개변수가 더 많은 경우 문제
- 매개변수는 메모리 내의 블록이나 테이블에 저장하고, 블록의 주소를 레지스터 내에 전달

### 시스템 콜의 유형

- 프로세스 제어 - 메모리 할당 및 회수, 프로세스 생성 및 종료 등
- 파일 조작 - 파일 생성, 삭제, 읽기, 쓰기 등
- 장치 관리 - 장치 요청, 제거, 속성 획득 등등
- 정보 유지 - 환경 설정 및 속성 제어 등
- 통신 - 통신 연결 생성 및 제거, 메시지 송수신 등
- 보호 - 파일 권한 관리

### 링커와 로더

- 컴파일 : 물리 메모리 위치에 적재되도록 **재배치 가능한 오브젝트 파일**로 변환
- 링커 : 재배치 가능한 오브젝트 파일을 **이진 실행 파일**로 결합
- 로더 : 이진 실행 파일을 **메모리에 적재**

  ![링커와 로더](https://user-images.githubusercontent.com/66675919/234514367-a91be88b-dea7-4dfe-a277-e03073b3c73e.png)

## 응용 프로그램이 운영체제마다 다른 이유

- 응용 프로그램이 여러 운영체제에서 실행될 수 있게 하는 방법
    - 운영체제마다 인터프리터가 제공되는 인터프리터 언어로 작성한다.
    - 응용 프로그램을 포함하고 있는 가상 머신을 가진 언어로 작성한다.
    - 기기 및 운영체제 고유의 이진 파일을 생성하는 표준 언어 또는 API를 사용한다.
- 응용 프로그램이 다른 운영체제에서 실행되지 않는 이유
    - 운영체제가 호출하도록 설계된 API를 제공하지 않는 경우
    - 응용 프로그램 이진 형식이 맞지 않는 경우
    - CPU가 가진 명령어 집합을 포함하지 않는 경우
    - 운영체제에 따라 시스템 콜이 다른 경우

## 운영체제 구조

- 커널 : 메모리에 상주하는 OS의 핵심 부분
- 유틸리티 : 비상주 프로그램

### 모놀리식 구조

- 커널의 모든 기능을 단일 주소 공간에서 실행되는 단일 정적 이진 파일에 넣는 구조
- 시스템 콜 인터페이스 아래, 물리적 하드웨어 위 모든 것이 커널
    
    ![모놀리식 구조](https://user-images.githubusercontent.com/66675919/234514424-ae083c9a-1048-4989-a32d-299c857be383.png)
    
- 단순함에도 불구하고 구현 및 확장이 어려움
- 오버헤드가 거의 없고 커널 내에서 통신 속도가 빠름

### 계층 구조

- 최하위 층(0층 - 하드웨어)부터 최상위 층(N층 - 사용자 인터페이스)의 계층 구조

    ![계층 구조](https://user-images.githubusercontent.com/66675919/234514450-696cd937-f1f3-4bc3-847e-61036e935031.png)

- 기능별로 모듈화된 구조
    - 검증 및 수정이 용이하다 - 오류가 발생하면 그 하위 층은 디버깅 되어 있음
- 설계 및 구현 단순화
- 계층 통과하면서 오버헤드 발생하여 단일 구조 대비 성능 저하 발생

### 마이크로 커널

- 커널의 필수 기능만 구현
    - 기타 기능은 사용자 수준 프로그램으로 별도 구현
- 확장이 쉽다
- 서비스 대부분이 사용자 프로세스로 더 높은 보안성과 신뢰성 제공

### 적재가능 커널 모듈(LKM)

- 커널이 핵심 서비스를 제공
- 다른 서비스들은 커널이 실행되는 동안 동적으로 구현
