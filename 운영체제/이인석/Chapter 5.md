# Chapter 5. CPU 스케줄링

## CPU 스케줄링?

- CPU 이용률 최대화(항상 1개는 실행) ⇒ 시스템의 성능 향상 목적
- CPU 버스트 : CPU 사용 시간
- I/O 버스트 : I/O 대기 시간

### CPU 스케줄러

- 실행 준비가 되어 있는 메모리 내의 프로세스 중 1개에 CPU를 할당
- PCB가 저장된 준비 큐에서 선택, 준비 큐는 선입선출 큐, 우선순위 큐, 트리, 연결 리스트로 구성

### 선점 스케줄링, 비선점 스케줄링

CPU의 스케줄링 결정은 다음의 상황에서 발생 가능

- 프로세스가 실행 상태에서 대기 상태로 전환 - I/O 혹은 이벤트 대기
- 프로세스가 실행 상태에서 준비 완료 상태로 전환 - 인터럽트
- 프로세스가 대기 상태에서 준비 완료 상태로 전환 - I/O 혹은 이벤트 완료
- 프로세스가 종료

1번과 4번 상황에서만 스케줄링이 발생하는 경우, 비선점 스케줄링이라고 함.

- 선점 스케줄링 : 실행 중인 프로세스가 다른 프로세스에 의해 자원을 뺏길 수 있음
    - Context Switch 오버헤드가 큼
    - Race Condition 가능성
- 비선점 스케줄링 : 한 프로세스가 자원을 할당 받으면 종료될 때까지 사용함
    - Context Switch 오버헤드가 적음
    - 평균 응답 시간 증가, 잦은 우선순위 역전

### 디스패처

CPU 스케줄링 기능에 포함된 요소

- Context Switch, 사용자 모드 전환, 사용자 프로그램의 적절한 위치로 점프
- 하나의 프로세스를 정지하고 다른 프로세스 수행 시작까지의 시간을 **디스패처 지연**이라고 함.

### 스케줄링 기준

- CPU 이용률
- 처리량
- 총 처리 시간
- 대기 시간
- 응답 시간

## 스케줄링 알고리즘

### FCFS(선입 선처리 스케줄링)

- 자원을 먼저 요청한 프로세스에게 우선 할당
- 비선점 스케줄링
- 큐로 간단하게 관리 가능
- Convoy Effect 발생 ⇒ 후순위 프로세스 작업이 늦어질 수 있음

### SJF(최단 작업 우선 스케줄링), SPN

- CPU Bust Time이 제일 적은 프로세스 먼저 처리
- 비선점 스케줄링
- 주어진 프로세스 집합에 대해서 최소 평균 대기 시간을 가짐
    - 시스템 내 프로세스 수 최소화 ⇒ 부하 감소, 메모리 절약 ⇒ 효율 향상
    - 많은 프로세스에 빠른 응답 시간 제공
- 정확한 실행 시간을 알 수 없어 실행시간 예측 기법이 필요
- Starvation (무한 대기, 기아) 현상 발생
    - 우선 순위 스케줄링을 하는 경우 실행 준비는 되어 있으나 Bust Time이 긴 경우 자원을 계속 할당 받지 못하고 계속 봉쇄되어 있을 수 있다.
    - 해결하기 위한 대표적인 방법은 aging이 있는데, 이를 활용한 예로 HRRN(대기 시간을 고려)가 있다.

### SRTF(최소 잔여 시간 우선 스케줄링), SRTN

- 선점형 SJF
- 선점 스케줄링
    - 잔여 시간이 더 적은 프로세스가 ready 상태가 되면 선점이 발생함
- 실행 시간 예측 필요, 잔여 실행 지속 추적 필요

### RR(라운드 로빈 스케줄링)

- 먼저 요청한 순서로 자원 할당, 시간 할당량이 끝나면 자원 반납
- 선점 스케줄링
- 원형 큐로 동작
- 시간 할당량이 매우 커지면 FCFS와 동일하게 동작함

### Multi-level Queue(다단계 큐 스케줄링)

- 우선 순위마다 큐를 가지는 방법, 큐의 내부 외부로 스케줄링
- 각각의 큐는 자신만의 스케줄링 기법을 사용하고, 작업은 배정된 큐를 벗어나지 못함
- 큐 사이에는 우선 순위 기반의 선점형 스케줄링 사용
- 우선 순위가 낮은 큐는 starvation 현상 발생 가능

### Multi-level Feedback Queue(다단계 큐 스케줄링)

- 큐 사이의 프로세스의 이동을 허용하는 스케줄링 ⇒ 프로세스의 우선 순위 변경 가능
- CPU Bust Time이 낮으면 높은 큐에 배정

## 실시간 CPU 스케줄링

- soft 실시간 시스템 : 프로세스가 스케줄 되는 시점에 아무것도 보장하지 않음
- hard 실시간 시스템 : 주어진 테스크가 반드시 마감시간까지 서비스 되어야 함
- 인터럽트 지연시간
    - 인터럽트 서비스 루틴 전 인터럽트 유형을 결정하고, Context Switching 하는 과정에 소요되는 시간
    - 인터럽트 발생부터 ISR(인터럽트 서비스 루틴) 실행 전까지
- 디스패치 지연시간
    - 디스패처가 하나의 프로세스를 블록시키고 다른 프로세스를 시작하는 데까지 걸리는 시간
    - Context Switching부터 프로세스 실행 전까지
