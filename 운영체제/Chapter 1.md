# Chapter 1. 서론 - 운영체제?

## 운영체제의 역할

- 사용자 관점 ⇒ **사용자 인터페이스**
- CPU 시간, 메모리, 저장장치, 입출력 등 자원을 관리하는 **자원 할당자**
- 컴퓨터의 부적절한 사용 방지를 위한 **제어 프로그램**

## 컴퓨터 시스템의 구성

### 인터럽트

![컴퓨터 시스템](https://user-images.githubusercontent.com/66675919/233021081-c2b411ec-359f-418e-b702-bd1ce397ba71.PNG)

- 컨트롤러가 장치 드라이버에게 작업을 완료했다는 사실을 알릴 때도 사용
- 하드웨어는 시스템 버스를 통해 CPU에 신호를 보내 **인터럽트를 발생 가능**
- CPU가 인터럽트 되면, CPU는 하던 일을 중단하고 즉시 **인터럽트 서비스 루틴 위치로 이동**
- 인터럽트 서비스 루틴 실행 완료 이후, **인터럽트 되었던 연산 재개**

인터럽트 서비스 루틴

![인터럽트 사이클](https://user-images.githubusercontent.com/66675919/233021125-994deeba-7100-44b1-9467-3b2cc08c9a06.png)

- 하나의 **명령어 실행 이후 CPU는 IRQ(Interupt Request Line) 확인**, 요청이 있으면 인터럽트 핸들러로 연결한다.
- 인터럽트 발생 빈도가 매우 빈번하고, 빠르게 처리되어야 하기 때문에 핸들러 루틴의 **포인터들의 테이블(인터럽트 벡터 테이블)을 이용 가능**
- CPU는 장치 고유 번호를 인터럽트 벡터의 인덱스로 **인터럽트 핸들러 루틴 호출**

인터럽트의 구현

- 인터럽트 요청 라인으로 복구할 수 없는 이벤트를 위해 예약된 **마스크 불가능 인터럽트**와 장치 컨트롤러가 서비스를 요청하기 위해 사용되는 **마스킹 가능** 인터럽트 라인이 있다.
- 컴퓨터에는 인터럽트 벡터의 주소 개수보다 많은 장치가 있기 때문에, 이를 해결하기 위해 일반적으로 **인터럽트 체인**을 사용한다.
- 긴급한 작업을 먼저 수행하기 위해 인터럽트 우선순위 시스템을 사용한다.

### 저장장치 구조

- CPU는 메모리에서만 명령을 적재할 수 있으므로, 실행하려면 프로그램을 먼저 메모리에 적재해야 한다.
- 대부분 **메인 메모리(RAM)을 사용해 프로그램을 가져온다.**
- RAM은 휘발성 메모리이므로 부트 스트랩 프로그램을 유지하기에 적합하지 않아, **전기적으로 소거 가능한 EEPROM을 사용**한다.

메모리

- 상호 작용은 특정 메모리 주소들에 대한 일련의 적재 또는 저장 명령을 통해 이루어진다.
- 적재(load)란 **메인 메모리로부터 CPU 내부의 레지스터로 한 바이트 또는 한 워드를 옮기는 것**

저장장치 계층 구조

- 메인 메모리는 모든 프로그램과 데이터를 영구 저장하기엔 너무 작으며, 휘발성 메모리이다.
- 대부분의 컴퓨터 시스템은 **대량의 데이터를 영구 저장할 수 있는 보조저장장치(HDD, NVM)**를 제공한다.
- 또 다른 구성 요소로 캐시, 자기 테이프, Blu-ray 등이 있으며, **저장 용량 및 액세스 시간에 따라 계층 구조로 구성될 수 있다**.

![저장장치 계층 구조](https://user-images.githubusercontent.com/66675919/233021175-d8a67e88-fbf7-430a-bb59-db26de5a7f9a.PNG)

### 입출력 구조

- 인터럽트 구동 I/O의 형태는 소량의 데이터엔 효과적이지만 대량 데이터 이동에 사용될 때 높은 오버헤드를 유발할 수 있다.
- **대량의 데이터 이동엔 직접 메모리 액세스(DMA)가 사용**되며, **CPU의 개입 없이 버퍼 장치와 메모리 사이에서 데이터 블록 전체를 전송**한다.
- 한 바이트마다 인터럽트가 발생하는 것이 아닌 **블록 전송이 완료될 때마다 인터럽트가 발생**한다.

## 컴퓨터 시스템 구조

### 단일 처리기 시스템

- 단일 처리 코어를 가진 하나의 CPU를 포함하는 단일 프로세서
- 코어는 명령을 실행하고 로컬로 데이터를 저장하기 위한 레지스터를 포함하는 구성 요소

### 다중 처리기 시스템

- 단일 코어 CPU가 있는 프로세서가 2개 이상으로 이루어진 시스템
- **N개의 프로세서의 속도 향상 비율은 N이 아니다**.
    - 여러 프로세서가 하나의 작업에 협력할 때, 올바르게 작동하도록 유지하는 것에 일정한 오버헤드 발생

### SMP

일반적인 다중 처리기 시스템로 SMP(대칭형 다중 처리 구조)가 있으며, 이는 각 피어 CPU 프로세서가 운영체제 기능 및 사용자 프로세스를 포함한 모든 작업을 수행한다.

![SMP](https://user-images.githubusercontent.com/66675919/233021208-335987d7-e72f-49ac-a46e-f28dfcca7a1f.PNG)

- 각 CPU 처리기에 캐시 뿐만 아니라 자체 레지스터 세트가 있다.
- 모든 프로세서는 시스템 버스를 통해 물리 메모리를 공유한다.
- N개의 CPU가 있으므로 N개의 프로세스를 성능을 크게 저하하지 않고 실행할 수 있다.
- 하나가 유휴 상태이고 하나가 과부하인 비효율적인 상황이 발생할 수 있다.

### 다중 코어 시스템

다중 처리기의 정의는 여러 개의 컴퓨팅 코어가 단일 칩에 상주하는 다중 코어 시스템을 포함한다.

![다중 코어 시스템](https://user-images.githubusercontent.com/66675919/233021231-aae4baef-1099-4435-8be5-c780376e4833.PNG)

- 칩 내 통신이 칩 간 통신보다 빠르므로 단일 코어를 가지는 여러 칩보다 효율적일 수 있다.
- 각 코어에 자체 레지스터 세트와 레벨 1 캐시가 있고, 칩에 국한되지만 두 처리 코어에서 공유하는 레벨 2 캐시가 존재한다.

### NUMA(non-uniform memory access)

CPU에 작고 빠른 로컬 버스를 통해 엑세스 되는 자체 로컬 메모리를 제공하여 모든 CPU가 공유 시스템 연결로 연결되어 하나의 물리 주소 공간을 공유하는 시스템.

- **CPU가 로컬 메모리에 액세스할 때 빠르다**는 장점과 **시스템 상호 연결에 대한 경합이 없다**는 장점이 있다.
- CPU가 시스템 상호 연결을 통해 원격 메모리에 액세스 해야할 때, 지연 시간이 증가하여 성능 저하가 발생할 수 있다.

### 블레이드 서버

다수의 처리기 보드 및 입출력 보드, 네트워킹 보드들이 하나의 섀시 안에 장착되는 형태

### 클러스터형 시스템

- 둘 이상의 독자적 시스템 또는 노드들을 연결하여 구성
- 높은 가용성(availability)을 제공하기 위해서 사용
    - 각 노드는 하나 이상의 다른 노드를 감시하고, 고장 난 노드의 저장장치에 대한 소유권을 넘겨 받아 실행 중이던 응용 프로그램을 다시 시작한다.
    - 남아 있는 하드웨어 수준에 비례하여 서비스를 계속 제공하는 기능을 **우아한 성능 저하**라고 한다.
- 비대칭형 클러스터링에서는 **한 컴퓨터가 긴급 대기 모드 상태를 유지**한다. 이 호스트는 활성 서버들의 감시 작업만을 수행한다.
- 대칭형 클러스터링에서는 **각 호스트들이 서로를 감시**한다.
- 한 클러스터가 네트워크로 연결된 다수의 컴퓨터 시스템으로 구성되므로 고성능 계산환경을 제공하도록 사용할 수 있다.
    - 프로그램을 컴퓨터의 개별 코어에서 혹은 클러스터의 각 컴퓨터에서 수행되는 요소로 나누는 작업을 **병렬화**라고 한다.

## 운영체제의 작동

- 컴퓨터 작동 시 초기 프로그램 또는 부트 스트랩 프로그램을 실행
    - 일반적으로 하드웨어 내 펌웨어로 저장
- 커널이 적재되어 실행되면 시스템과 사용자에게 서비스 제공 가능
    - 일부 서비스는 시스템 데몬이 되기 위해 부팅할 때 메모리에 적재되는 시스템 프로그램에 의해 커널 외부에서 제공된다. (ex : Liunux에서의 “systemd”)
- 시스템이 완전히 부팅된 이후 시스템은 이벤트가 발생할 때까지 대기
- 이벤트는 거의 항상 인터럽트를 발생 시켜서 신호를 보낸다.
    - 컨트롤러에서 발생하는 인터럽트 이외에도 트랩(또는 예외), 오류, 소프트웨어 생성 인터럽트가 있으며, 이런 요청은 **시스템 콜이라는 특수 연산을 실행**

### 다중 프로그래밍과 다중 태스킹

- **CPU가 항상 한 개는 실행할 수 있도록 프로그램을 구성하는 것을 다중 프로그래밍**이라고 한다.
    - CPU 이용률을 높이고 사용자 만족도를 높일 수 있다.
- 다중 프로그램 시스템에서 실행 중인 프로그램을 프로세스라고 한다.
- 다중 태스킹은 다중 프로그래밍의 논리적 확장으로 CPU가 여러 프로세스를 전환하며 프로세스를 실행하지만 전환이 자주 발생하여 사용자에겐 빠른 응답 시스템을 제공하게 된다.

### 이중-모드와 다중 모드 운용

- 운영체제는 잘못된 프로그램으로 인해 다른 프로그램 또는 운영체제가 잘못 실행될수 없도록 보장해야 한다.
- **사용자 모드와 커널 모드**를 제공하여 운영체제를 위해 실행되는 작업과 사용자를 위해 실행되는 작업을 구분한다.
- 사용자 모드에서 커널 모드로의 전환
    - 시스템 부트 시, 하드웨어는 커널 모드에서 시작
    - 운영체제가 적재되고, 사용자 모드에서 사용자 프로세스 시작
    - 트랩이나 인터럽트 발생 시, 하드웨어는 사용자 모드에서 커널 모드로 전환
- 악영향을 끼칠 수 있는 일부 명령을 특권 명령으로 지정하여, 해당 명령이 커널 모드에서만 수행될 수 있도록 허용한다.
    - 사용자 모드에서 특권 명령을 수행하려 하면, 하드웨어는 불법적인 명령으로 간주해 운영체제에 트랩을 건다.

![사용자 모드-커널 모드](https://user-images.githubusercontent.com/66675919/233021306-dca0c139-789e-4988-af64-94a0762e80b6.PNG)

### 타이머

- 지정된 시간 후에 컴퓨터를 인터럽트할 수 있도록 설정
- 사용자 프로그램이 무한 루프에 빠지거나 시스템 서비스 호출에 실패하여 운영체제로 복귀하지 못하는 경우 방지

## 자원 관리

### 프로세스 관리

- 프로세스는 다음 수행할 명령을 지정하는 프로그램 카운터를 가진 능동적 개체
- 운영체제는 프로세스 관리와 연관해 다음과 같은 책임을 가진다.
    - 사용자 프로세스와 시스템 프로세스의 생성과 제거
    - CPU에 프로세스와 스레드 스케줄하기
    - 프로세스 일시 중지와 재수행
    - 프로세스 동기화를 위한 기법 제공
    - 프로세스 통신을 위한 기법 제공

### 메모리 관리

운영체제 역할

- 메모리 어느 부분이 사용되고 있는지, 어느 프로세스에 의해 사용되는지 추적
- 필요에 따른 메모리 공간 할당 및 회수
- 어떤 프로세스를 적재하고 제거할 것인지에 대한 결정

### 파일 시스템 관리

운영체제 역할

- 파일의 생성 및 제거
- 디렉토리 생성 및 제거
- 파일과 디렉토리를 조작하기 위한 프리미티브 제공
- 파일을 보조저장장치로 매핑
- 안정적인(비휘발성) 저장 매체에 파일 백업

### 대용량 저장 장치 관리

운영체제 역할

- 마운팅과 언마운팅
- 사용 가능 공간의 관리
- 저장장소 할당
- 디스크 스케줄링
- 저장장치 분할
- 보호

### 캐시 관리

- 캐시 크기가 제한되어 있기 떄문에 캐시 크기와 교체 정책을 신중히 선택해야 한다.

### 입출력 시스템 관리

- 운영체제의 목적 중 하나는 사용자에게 특정 하드웨어 장치의 특성을 숨기는 것
- 장치 드라이버만이 자신에게 지정된 특정 장치의 특성을 알고 있다.

## 보안과 보호

- 컴퓨터 시스템이 정의한 자원에 대해 프로그램, 프로세스 또는 사용자들의 접근을 제어하는 기법을 보호라고 한다.
- 외부 또는 내부의 공격을 방어하는 기능을 보안이라고 한다.
- 보호와 보안을 제공하기 위해서는 시스템의 모든 사용자를 구분할 수 있어야 한다.
    - 운영체제 대부분은 사용자 식별자의 리스트를 유지한다.
    - 사용자를 그룹화하여 그룹 식별자의 리스트를 유지할 수도 있다.
    - 사용자가 원하는 작업을 수행하기 위해서 권한을 상승해야 하는 경우도 있다.

## 가상화

- 단일 컴퓨터의 하드웨어를 여러 실행 환경으로 추상화하여 개별 환경이 자신만의 컴퓨터에서 실행되고 있다는 환상을 만들 수 있는 기술

## 분산 시스템

- 물리적으로 떨어져 있는 이기종 컴퓨터들의 집합
- 네트워크
    - 두 개 이상의 시스템 간의 통신 경로
    - 가장 일반적으로 TCP/IP가 있다.
- 네트워크는 노드 간의 거리에 의해 유형이 결정
    - 근거리 통신망(LAN) : 한 방, 한 층 또는 한 건물
    - 광역 통신망(WAN) : 건물, 도시 또는 국가 사이
    - 도시권 통신망(MAN) : 한 도시 내의 건물들
    - 단거리 통신망(PAN) : 수 미터의 짧은 거리 통신
- 네트워크 운영체제
    - 다른 컴퓨터의 다른 프로세스가 메세지를 교환할 수 있도록 하는 통신 체계 제공
    - 네트워크를 통한 파일 공유와 같은 기능을 제공

## 계산 환경

### 클라이언트 서버 컴퓨팅

서버 시스템이 클라이언트 시스템이 생성한 요청을 만족시키는 시스템

- 계산-서버 시스템은 클라이언트가 어떤 작업을 요청할 수 있는 인터페이스를 제공
- 파일-서버 시스템은 클라이언트가 파일을 생성, 갱신, 읽기 및 제거할 수 있는 파일 시스템 인터페이스를 제공

### 피어 간 계산

- 피어 간 시스템(P2P)에서는 클라이언트와 서버가 서로 구별되지 않는다.
- 노드가 네트워크에 참가할 때, 중앙 검색 서비스에 자신이 제공하는 서비스를 등록한다.
    - 특정 서비스를 원하는 노드는 먼저 중앙 검색 서비스를 통하여 어떤 노드가 해당 서비스를 제공하는지 확인한다.
- 중앙 검색 서비스를 사용하지 않는 경우 서비스를 제공하는 노드를 찾기 위해 네트워크 상의 모든 노드에게 서비스 요청 메시지를 발송한다.
    - 이 방법을 지원하기 위해서는 발견 프로토콜이 제공되어야 한다.

### 클라우드 컴퓨팅

- 계산, 저장장치, 그 응용  모두 네트워크를 통한 서비스로 제공하는 계산 유형
- 공중 클라우드
    - 서비스를 위해 지불 가능한 사람은 누구나 인터넷을 통해 사용 가능한 클라우드
- 사유 클라우드
    - 한 회사가 사용하기 위해 운영하는 클라우드
- 혼합형 클라우드
    - 공공과 사유 부분을 모두 포함하는 클라우드
- 소프트웨어 서비스(SaaS)
    - 인터넷을 통해 사용 가능한 하나 이상의 응용 서비스
- 플랫폼 서비스(PaaS)
    - 인터넷을 통해 사용하도록 응용에 맞게 준비된 소프트웨어 스택
- 하부 구조 서비스(IaaS)
    - 인터넷을 통해 사용 가능한 서버나 저장 장치

### 실시간 내장형 시스템

- 내장형 운영체제를 가지고 있는 하드웨어 형태 혹은 운영체제 없이 필요한 작업을 수행하는 응용 전용 칩만을 갖는 하드웨어
- 내장형 시스템은 거의  언제나 실시간 운영체제를 수행한다.
