# Chapter 4. 스레드와 병행성
## 4.1. 개요
- 스레드란?
  - CPU 이용의 기본단위.
  - 스레드 ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성
  - 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 열린 파일이나 신호와 같은 운영체제 자원 공유

- 다중스레드의 장점
  - 응답성 : 프로그램 수행이 계속되는 것을 허용
  - 자원 공유 : 프로세스의 자원들과 메모리를 공유하므로, 
  - 경제성 : 프로세스 생성은 메모리/자원 할당 비용이 큼. 스레드는 프로세스 자원을 공유하며, 일반적으로 프로세스 생성보다 시간과 메모리 덜 소비. context switch또한 스레드가 더 빠름
  - 규모 적응성 : 다중 처리기 구조에서 이점 증가.

## 4.2. 다중 코어 프로그래밍
- 다중 코어 시스템을 위해 프로그래밍하기 위한 5개 도전과제
  - 태스크 인식
  - 균셩
  - 데이터 분리
  - 데이터 종속성
  - 시험 및 디버깅
- 병렬 시행 유형
  - 데이터 병렬 시행 : 동일한 데이터의 부분집합을 다수의 계산 코어에 분배
  - 태스크 병령 시행 : 태스크(스레드)를 다수의 코어에 분배

## 4.3. 다중 스레드 모델
- 사용자 스레드
  - 사용자 영역의 스레드 라이브러리로 구현
    - 스레드 생성, 스케줄링 등
  - 커널은 스레드의 존재를 모름
    - 커널의 관리를 받지 않음
    - 프로세스 단위로 자원 할당
- 커널 스레드
  - OS가 직접 관리
  - 커널 영역에서 스레드 생성, 관리 수행
  - 커널에 의해 각각 직접 지원, 관리.
### 다대일 모델
- 많은 사용자 수준 스레드를 하나의 커널 스레드로 매핑.
- 한 스레드가 blocking 콜을 하게 되면 전체 프로세스가 blocking됨
- 다중처리 코어의 이점을 살릴 수 없음
### 일대일 모델
- 각 사용자 스레드를 각각 하나의 커널 스레드로 매핑.
- 다대일 모델보다 더 많은 병렬성
- 사용자 스레드를 만들려면 커널 스레드를 만들어야됨. 이는 시스템에 부담됨
### 다대다 모델
- N(사용자 스레드) : M(커널 스레드), N >= M
- 사용자 스레드를 커널 스레드로 멀티플렉싱함.
- 다대일, 일대일의 단점을 해결하고 장점만 모음
  - 필요한 만큼 사용자 스레드 생성 가능
  - 커널스레드가 다중 처리기에서 병렬로 수행 가능
  - 스레드가 블로킹되면 다른 스레드의 수행을 스케줄링 가능  
- 구현하기 어렵다.

## 4.5. 암묵적 스레딩
### 스레드 풀
- 프로세스 시작 시 일정한 수의 스레드를 미리 풀로 만듬
- 풀에 스레드가 있으면 요청이 즉시 서비스, 없으면 대기
- 장점
  - 기존에 생성된 스레드로 서비스하는것이 종종 빠름
  - 임의로 스레드 개수 제한 가능. 많은 수의 스레드를 병렬 처리할 수 없는 시스템에 도움이 됨.
  - 태스크를 생성하는 방법을 테스크로부터 분리하여 테스크의 실행을 다르게 할 수 있음
- CPU수, 메모리 용량, 동시 요청 클라이언트 최대 수 등을 고려하여 스레드 갯수 정함.