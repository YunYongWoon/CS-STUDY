# Chapter5. CPU 스케쥴링
## 5.1. 기본 개념
- 다중 프로그래밍의 목적
  - CPU 이용률을 최대화 -> 항상 실행중인 프로세스를 가지게 함
  - 다수의 프로세스를 메모리에 유지하며, 어떤 프로세스가 대기해야 할 경우 CPU를 해당 프로세스에서 회수하여 다른 프로세스에 할당
  - 자원을 할당 할 프로세스를 선택해야 한다 -> 이것이 스케쥴링
    - 자원 관리
      - 하나의 자원을 여러 스레드들이 번갈아가며 사용
      - 프로세스 스케줄링 ; 프로세서 사용시간을 프로세스들에게 분배
    - 공간 분할
      - 하나의 자원을 분할하여 동시 사용 
      - 메모리
- 스케줄링의 목적
  - 시스템 성능 향상
  - 성능 지표
    - 응답시간
    - 작업 처리량
    - 자원 활용도
  - 목적에 맞는 지표 고려하여 스케줄링 기법 선택
- 장기, 중기, 단기 스케줄러
  - 장기 스케줄러 : Job Pool에서 프로세스 선별, 실행을 위해 메모리에 적재
  - 중기 스케줄러 : Swapper라고도 부름. CPU를 사용중인 프로세스 중 어떤 프로세스를 내릴지 선택(내려진 프로세스는 디스크에 swap됨)
  - 단기 스케줄러 : 실행 준비(Ready)된 프로세스 중 하나를 선별해 CPU에 할당
### CPU-I/O 버스트 사이클
- CPU 버스트 : 프로세스의 시작
- I/O 버스트 : I/O 대기 시작
### CPU 스케줄러
- CPU의 유휴상태시 운영체제는 준비 큐에 있는 프로세스 중 하나를 선택해 실행. 이것을 CPU 스케줄러가 실행

### 선점/비선점 스케줄링
- CPU 스케줄링이 발생할 수 있는 상황
  1. 한 프로세스가 실행 상태에서 대기 상태로 전환
  2. 프로세스가 실행 상태에서 준비 상태로 전환
  3. 프로세스가 대기 상태에서 준비 완료 상태로 전환
  4. 프로세스 종료 시

- 비선점 스케줄링
	- 1, 4 상황에서만
	- CPU가 한 프로세스에 할당되면 프로세스 종료, 혹은 대기 상태로 전환되어 CPU를 방출할 때까지 점유
- 선점 스케줄링
  - race condition 초래 가능

### 디스패처
- 코어의 제어를 CPU 스케줄러가 선택한 프로세스에게 주는 모듈
  - context switching 수행
  - 사용자 모드로 전환
  - 프로그램을 다시 시작하기 위해 사용자 프로그램의 적절한 위치로 이동

## 5.2. 스케줄링 기준
	- CPU 이용률
	- 처리량
	- 총 처리 시간
	- 대기 시간
	- 응답시간

## 5.3. 스케줄링 알고리즘
### FCFS(선입선출 스케줄링)
- 비선점형
- CPU를 먼저 요청하는 프로세스가 CPU를 먼저 할당
- 평균 대기시간이 길어질 수 있는 단점 존재
- convoy effect : 모든 다른 프로세스들이 하나의 긴 프로세스가 CPU를 양도하기를 기다리는 것

### SJF(최단작업 우선 스케줄링)
- 비선점
- 버스트 시간(수행 시간)이 제일 낮은 프로세스부터 실행

### 라운드로빈(RR)
- 선점형 알고리즘
- time quantum(혹은 time slice)라는 작은 단위의 시간을 정하고, 해당 시간만큼 프로세스 실행
- time quantum이 너무 길면 RR은 FCFS로 회귀함.

### 우선순위 스케줄링
- 프로세스마다 우선순위를 주고, 우선순위가 높은 프로세스부터 작업 진행
- 무한 봉쇄, 혹은 기아상태의 문제점이 있음
  - 기아 상태 : 프로세스가 CPU사용을 무한히 대기만 하는 상태
    - 해결방식
      - aging(노화). 낮은 우선순위의 프로세세스들의 우선순위를 점진적으로 높히는 방법
      - RR과 결합

### 다단계 큐 스케줄링 (Mulitlevel Queue)
![image](https://user-images.githubusercontent.com/46861704/236663555-3c5eb8f4-ad35-49f5-9f63-b105fa494db3.png)
- 우선순위마다 별도의 큐를 가짐
  - 큐 하나에서 우선순위가 가장 높은 프로세스를 찾으려면 O(n)
  - 우선순위마다 별도의 큐를 가지게 되므로 프로세스 검색 시간이 줄어듬
- 큐마다 별도의 알고리즘 적용 가능
- 큐와 큐 사이에도 스케줄링이 존재할 수 있음

### 다단계 피드백 큐 스케줄링
- 프로세스가 큐 이동이 가능해진다. (CPU 버스트 성격에 따라 구분)
- 오래 기다리는 프로세스는 높은 우선순위 큐로도 이동 가능 (기아상태 예방)

## 5.6. 실시간 스케줄링
- soft 실시간 시스템 : 외부 이벤트에 응답하는 시간 제한이 존재하지만, 초과하더라도 중대한 문제 발생 안함
- hard 실시간 시스템 : 외부 이벤트에 명시된 시간 내에 응답하지 못하면 완전한 실패.

## 지연시간 최소화
- 인터럽트 지연시간 : CPU에 인터럽트 발생 후 부터 처리 루틴이 시작하기까지의 시간
  - 수행중인 명령어 완수, 인터럽트 종류 결정, ISR을 사용하여 인터럽트 처리 전 현재 프로세스 상태 저장등
- 디스패치 지연시간 : 스케줄링 디스패처가 하나의 프로세스 블록 후 다른 프로세스를 실행할때까지 걸리는 시간